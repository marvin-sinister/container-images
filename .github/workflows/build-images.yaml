name: Build images

on:
  workflow_dispatch:

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Build image
      run: |
        cd bind
        podman pull docker.io/library/alpine:latest
        ALPINE_TAG=$(podman inspect alpine:latest | jq -r '.[]["Annotations"]["org.opencontainers.image.version"]')
        podman build -t docker.io/marvinsinister/bind:alpine-${ALPINE_TAG} --build-arg ALPINE_TAG=${ALPINE_TAG} .
